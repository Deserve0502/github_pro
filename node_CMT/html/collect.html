<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/inner.css">
    <link rel="stylesheet" href="../css/reset.css">
</head>

<body>
    <iframe id="iframe_header" src="../static/header.html" frameborder="0"></iframe>
    <div class="layout-left">
        <div class="layout-left-left">
            <div class="list_header list_multHeader">
                <span>
                    <span class="authorName"></span>
                    收藏的话题</span>
            </div>
            <div class="contain_con coll_con">
                <ul class=" contain_section">
        
                </ul>
                </div>
</div>
        <div class="layout-right">
            <iframe id="iframe_author" src="../static/inner_author.html" frameborder="0"></iframe>
            <iframe id="iframe_comm" src="../static/inner_comm.html" frameborder="0"></iframe>
            <iframe id="iframe_ewm" src="../static/inner_ewm.html" frameborder="0"></iframe>
        </div>
    </div>
    <div class="return_con">
        回到顶部
    </div>
    <script src="../js/gotop.js"></script>
    <iframe id="iframe_bottom" src="../static/bottom.html" frameborder="0"></iframe>
    

</body>

</html>
<script src="../js/common.js"></script>
<script>
    let oframeHeader = document.getElementById('iframe_header');
    let oiframeAuthor = document.getElementById("iframe_author");
    let oiframeComm = document.getElementById("iframe_comm");
    let oiframeEwm = document.getElementById("iframe_ewm");
    let oiframeBottom = document.getElementById("iframe_bottom");
    let oiframeReturn = document.getElementById("iframe_return");
    const PX = 'px';


    window.addEventListener('message',
        function (e) {
            oframeHeader.style.height = e.data.oframeHeaderHeight + PX
            oframeHeader.style.width = e.data.oframeHeaderWidth + PX
        })
  
        window.addEventListener('message',
        function (e) {
            oiframeAuthor.style.height = e.data.oiframeAuthorHeight + 'px'
            oiframeAuthor.style.width = e.data.oiframeAuthorWidth + 'px'
        })
  
    window.addEventListener('message',
        function (e) {
            oiframeComm.style.height = e.data.oiframeCommHeight + PX
            oiframeComm.style.width = e.data.oiframeCommWidth + PX
        })
    window.addEventListener('message',
        function (e) {
            oiframeEwm.style.height = e.data.oiframeEwmHeight + PX
            oiframeEwm.style.width = e.data.oiframeEwmWidth + PX
        })

    window.addEventListener('message',
        function (e) {
            oiframeBottom.style.height = e.data.oiframeBottomHeight + PX
            oiframeBottom.style.width = e.data.oiframeBottomWidth + PX
        })






let ocollectSection = document.querySelector(".contain_section");
let oauthorName = document.querySelector(".authorName");

let ls = localStorage;
oauthorName.innerHTML = ls.getItem("author");
ajax({
        'url': 'https://cnodejs.org/api/v1/topic_collect/' + ls.getItem("author"),
        'type': 'get',
        data:{
           
        },
        success: function (data) {
            let dataJson = JSON.parse(data);
            containArr = dataJson.data;
            console.log(containArr)
            let ocontain_section_li = '';
            for (let i = 0; i < containArr.length; i++) {
                ocontain_section_li += `
            <li>
                    <span class='goPrin'>
                        <img src="../img/peo1.jpg">
                    </span>
                    <span>
                        <span class="reply_num">${containArr[i].reply_count}</span>
                        <span>/</span>
                        <span class="click_num">${containArr[i].visit_count}</span>
                    </span>
                    <span class="classify">${containArr[i].tab}</span>
                    <i style="display:none" class="isTop">${containArr[i].top}</i>
                    <span class='con_title'>${containArr[i].title}</span>
                    <div>
                        <img src="../img/peo2.png">
                    <span>
                        ${getLastTime(containArr[i].last_reply_at)}
                    </span>
                </div>
                </li>
            `
            }
            ocollectSection.innerHTML = ocontain_section_li;

            let ocontainList = document.querySelectorAll(".con_title");
            for (let i = 0; i < ocontainList.length; i++) {
                ocontainList[i].onclick = function () {
                    ls.setItem("articleId", containArr[i].id);
                    ls.setItem("author", containArr[i].author.loginname);
                    console.log(ls.getItem("articleId"));
                    window.top.location.href = '../html/invitation.html'

                }
            }
            let ogoPrin = document.querySelectorAll(".goPrin");
            for(let i = 0; i < ogoPrin.length; i++){
                ogoPrin[i].onclick = function(){
                    ls.setItem("articleId", containArr[i].id);
                    ls.setItem("author", containArr[i].author.loginname);
                    window.top.location.href = '../html/principal.html'
                }
            }

            let oconClassify = document.querySelectorAll('.contain_section > li > span:nth-of-type(3)');
            let oisTop = document.querySelectorAll(".isTop");
            for (let i = 0; i < oisTop.length; i++) {
                if (oisTop[i].innerHTML === 'false') {
                    if (containArr[i].good) {
                        oconClassify[i].innerHTML = '精华';
                    } else {
                        if (oconClassify[i].innerHTML === 'share') {
                            oconClassify[i].innerHTML = '分享';
                        } else if (oconClassify[i].innerHTML === 'dev')  {
                            oconClassify[i].innerHTML = '测试';
                        } else if (oconClassify[i].innerHTML === 'job'){
                            oconClassify[i].innerHTML = '招聘';
                        } else {
                            oconClassify[i].innerHTML = '问答';
                        }
                        oconClassify[i].style.color = '#999';
                        oconClassify[i].style.backgroundColor = '#e5e5e5'
                    }
                } else {
                    oconClassify[i].innerHTML = '置顶';
                }
            }
        }
    })
</script>