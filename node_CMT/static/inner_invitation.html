<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/inner.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/markdown.css">
</head>

<body>
    <div class="invitation_con">
    <div class="invi_con">

    </div>
    <div class="reply_con">

        <div class="list_header reply_header">
            <!-- <span>34</span>
            <span>回复</span> -->
        </div>
        <ul class="reply_list">
           
       
        </ul>


    </div>
</div>
</body>

</html>
<script src="../js/common.js"></script>
<script>
    let ls = localStorage;
    let oinviCon = document.querySelector(".invi_con");
    let oreplyHeader = document.querySelector(".reply_header");
    let oreplyList = document.querySelector(".reply_list");
    let oinvitationCon = document.querySelector(".invitation_con");
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(function(){
        let width = oinvitationCon.clientWidth
        let height = oinvitationCon.clientHeight
        window.parent.postMessage({
            oframeInviHeight: height,
            oframeInviWidth: width
        }, '*')
        },1000)
       
    }, false)
    let url = 'https://cnodejs.org/api/v1/topic/' + ls.getItem("articleId");
    let str;
    let invitationArr;
    let replyNum;
    let replyArr;
    let replyStr;
    ajax({
        'url': url,
        'type': 'get',
        success: function (data) {
            let invitationArr = JSON.parse(data).data;
            console.log(invitationArr);
            str = `<div class="invi_up"><span class="classify">置顶</span>
        <span class="invi_title">${invitationArr.title}</span>
        <li >
            <span>•</span>
            <span>发布于</span>
            <span>
                ${getLastTime(invitationArr.create_at)}
                </span>
            <span>•</span>
            <span>作者</span>
            <span>${invitationArr.author.loginname}</span>
            <span>•</span>
            <span>${invitationArr.visit_count}</span>
            <span>次浏览</span>
        </li>
    </div><div class="invi_down"><p>${invitationArr.content}</p> 
    </div>
            
            `
            oinviCon.innerHTML = str;
        replyNum = `
        <span>${invitationArr.reply_count}</span>
        <span>回复</span>
        `
        oreplyHeader.innerHTML = replyNum;
        
            replyArr = invitationArr.replies;
            
            
            if(replyArr.length !== 0){
                for(let i = 0;i<replyArr.length;i++){
            replyStr += `<li><div>
                <img src="../img/peo1.jpg">
                <span class="reply_name">${replyArr[i].author.loginname}</span>
                <span>${i + 1}</span>
                <span>楼</span>
                <span>•</span>
                <span>${getLastTime(replyArr[i].create_at)}</span>
                <span class='invi_author'>${replyArr[i].author.loginname===ls.getItem("author")?'作者':''}</span>
            </div>
            <p class='reply_content'>${replyArr[i].content}</p>
            </li>
            
            `
        }
        replyStr = replyStr.substr(9);
        oreplyList.innerHTML = replyStr;
        let inviAuthor = document.querySelectorAll(".invi_author");
        for(let i = 0;i<inviAuthor.length;i++){
            if(inviAuthor[i].innerHTML ===''){
                inviAuthor[i].style.backgroundColor = 'white';
            }
        }

      
            }else{
                let oreplyCon = document.querySelector(".reply_con");
                oreplyCon.style.display = 'none';
                // oreplyList.innerHTML = '无';
            }
       
        
        }

      


        
    })
</script>